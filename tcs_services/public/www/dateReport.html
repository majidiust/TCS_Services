<!DOCTYPE html>

<!--[if IEMobile 7]>
<html class="no-js iem7 oldie"><![endif]-->
<!--[if (IE 7)&!(IEMobile)]>
<html class="no-js ie7 oldie" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]>
<html class="no-js ie8 oldie" lang="en"><![endif]-->
<!--[if (IE 9)&!(IEMobile)]>
<html class="no-js ie9" lang="en"><![endif]-->
<!--[if (gt IE 9)|(gt IEMobile 7)]><!-->
<html class="no-js" lang="en"><!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>سیستم کنترل تردد گروه صنعتی کاوه</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- http://davidbcalhoun.com/2010/viewport-metatag -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Additional styles -->
    <link rel="stylesheet" href="css/styles/form3860.css?v=1">
    <link rel="stylesheet" href="css/styles/modal3860.css?v=1">
    <link rel="stylesheet" href="css/styles/progress-slider3860.css?v=1">
    <link rel="stylesheet" href="css/styles/switches3860.css?v=1">
    <link rel="stylesheet" href="css/styles/table3860.css?v=1">
    <link rel="stylesheet" href="css/kss.css">

    <!-- For all browsers -->
    <link rel="stylesheet" href="css/reset3860.css?v=1">
    <link rel="stylesheet" href="css/style3860.css?v=1">
    <link rel="stylesheet" href="css/colors3860.css?v=1">
    <link rel="stylesheet" media="print" href="css/print3860.css?v=1">
    <!-- For progressively larger displays -->
    <link rel="stylesheet" media="only all and (min-width: 480px)" href="css/4803860.css?v=1">
    <link rel="stylesheet" media="only all and (min-width: 768px)" href="css/7683860.css?v=1">
    <link rel="stylesheet" media="only all and (min-width: 992px)" href="css/9923860.css?v=1">
    <link rel="stylesheet" media="only all and (min-width: 1200px)" href="css/12003860.css?v=1">
    <!-- For Retina displays -->
    <link rel="stylesheet"
          media="only all and (-webkit-min-device-pixel-ratio: 1.5), only screen and (-o-min-device-pixel-ratio: 3/2), only screen and (min-device-pixel-ratio: 1.5)"
          href="css/2x3860.css?v=1">

    <!-- DataTables -->
    <link rel="stylesheet" href="js/libs/DataTables/jquery.dataTables3860.css?v=1">

    <!-- Webfonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>

    <!-- Additional styles -->
    <link rel="stylesheet" href="css/styles/progress-slider3860.css?v=1">
    <link rel="stylesheet" href="css/styles/switches3860.css?v=1">
    <link rel="stylesheet" href="css/styles/files3860.css?v=1">

    <!-- JavaScript at bottom except for Modernizr -->
    <script src="js/libs/modernizr.custom.js"></script>

    <!-- For Modern Browsers -->
    <link rel="shortcut icon" href="img/favicons/favicon.png">
    <!-- For everything else -->
    <link rel="shortcut icon" href="img/favicons/favicon.ico">
    <!-- For retina screens -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/favicons/apple-touch-icon-retina.png">
    <!-- For iPad 1-->
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/favicons/apple-touch-icon-ipad.png">
    <!-- For iPhone 3G, iPod Touch and Android -->
    <link rel="apple-touch-icon-precomposed" href="img/favicons/apple-touch-icon.png">

    <!-- iOS web-app metas -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!-- Startup image for web apps -->
    <link rel="apple-touch-startup-image" href="img/splash/ipad-landscape.png"
          media="screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:landscape)">
    <link rel="apple-touch-startup-image" href="img/splash/ipad-portrait.png"
          media="screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:portrait)">
    <link rel="apple-touch-startup-image" href="img/splash/iphone.png" media="screen and (max-device-width: 320px)">

    <!-- Microsoft clear type rendering -->
    <meta http-equiv="cleartype" content="on">
</head>

<body class="clearfix with-menu with-shortcuts">

<!-- Prompt IE 6 users to install Chrome Frame -->
<!--[if lt IE 7]><p class="message red-gradient simpler">Your browser is <em>ancient!</em> <a
        href="http://browsehappy.com/">Upgrade to a different browser</a> or <a
        href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.
</p><![endif]-->

<!-- Title bar -->
<header role="banner" id="title-bar">
    <h2>
        سیستم کنترل تردد گروه صنعتی کاوه
    </h2>
</header>

<!-- Button to open/hide menu -->
<a href="javascript:void(0);" id="open-menu"><span>منو</span></a>

<!-- Button to open/hide shortcuts -->
<a href="javascript:void(0);" id="open-shortcuts"><span class="icon-thumbs"></span></a>

<!-- Main content -->
<section role="main" id="main">

    <noscript class="message black-gradient simpler">مرورگر شما از این نسخه از جاوا اسکریپت پیروی نمیکند. ممکن است بعضی
        از قابلیت ها کار نکند.
    </noscript>

    <div class="with-padding">
        <table border="1" style="width: 100%;text-align: right;direction: rtl;">
            <thead>
            <th></th>
            <th style="text-align: center; font-family: tahoma;">
                از تاریخ
            </th>
            <th style="text-align: center; font-family: tahoma;">
                تا تاریخ

            </th>
            </thead>
            <tbody>
            <tr>
                <td colspan="3">
                    <hr/>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="from_date_day" class="label">روز</label>
                </td>
                <td style="text-align: center;">
                    <select id="from_date_day" name="from_date_day" class="select validate[required]">
                        <option value="">انتخاب کنید</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                        <option value="26">26</option>
                        <option value="27">27</option>
                        <option value="28">28</option>
                        <option value="29">29</option>
                        <option value="30">30</option>
                        <option value="31">31</option>
                    </select>

                </td>
                <td style="text-align: center;">
                    <select id="to_date_day" name="to_date_day" class="select validate[required]">
                        <option value="">انتخاب کنید</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                        <option value="26">26</option>
                        <option value="27">27</option>
                        <option value="28">28</option>
                        <option value="29">29</option>
                        <option value="30">30</option>
                        <option value="31">31</option>
                    </select>

                </td>
            </tr>
            <tr>
                <td>
                    <label for="from_date_month" class="label">ماه</label>

                </td>
                <td style="text-align: center;">

                    <select id="from_date_month" name="from_date_month" class="select validate[required]">
                        <option value="">انتخاب کنید</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                    </select>

                </td>
                <td style="text-align: center;">

                    <select  id="to_date_month" name="to_date_month" class="select validate[required]">
                        <option value="">انتخاب کنید</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                    </select>

                </td>
            </tr>

            <tr>
                <td>
                    <label for="from_date_year" class="label">سال</label>

                </td>
                <td style="text-align: center;">

                    <select  id="from_date_year" name="from_date_year" class="select validate[required]">
                        <option value="">انتخاب کنید</option>
                        <option value="1393">1393</option>
                    </select>

                </td>
                <td style="text-align: center;">

                    <select id="to_date_year" name="to_date_year" class="select validate[required]">
                        <option value="">انتخاب کنید</option>
                        <option value="1393">1393</option>
                    </select>

                </td>
            </tr>
            <tr>
                <td colspan="3" style="text-align: center;">
                    <hr/>
                </td>
            </tr>
            <tr>
                <td colspan="3" style="text-align: center;">
                    <div class="button-height" ><button class="button green-gradient" style="font-family: Tahoma; font-size: 12px; width: 50%;" onclick="queryByDate();">جستجو</button></div>
                </td>
            </tr>
            </tbody>

        </table>
<hr/>

        <table class="table responsive-table"
               style="width:100%;font-family: tahoma, verdana, sans-serif; direction: rtl;" id="traffic_table">

            <thead>

            <th scope="col" width="20%" class="align-center">تاریخ</th>
            <th scope="col" width="20%" class="align-center">زمان</th>
            <th scope="col" width="20%" class="align-center">پلاک</th>
            <th scope="col" width="40%" class="align-center">ابزار</th>

            </thead>
        </table>
    </div>
</section>
<!-- End main content -->

<!-- Side tabs shortcuts -->
<ul id="shortcuts" role="complementary" class="children-tooltip tooltip-right">
    <li><a href="overview.html" class="shortcut-agenda" title="گزارش گیری">گزارش گیری</a></li>
    <li><a href="main.html" class="shortcut-messages" title="رخدادها">رخدادها</a></li>
    <li><a href="settings.html" class="shortcut-settings" title="تنظیمات">تنظیمات</a></li>
    <li class="current"><a href="dateReport.html" class="shortcut-contacts" title="براساس تاریخ">براساس تاریخ</a></li>
</ul>

<!-- Sidebar/drop-down menu -->
<section id="menu" role="complementary">

    <!-- This wrapper is used by several responsive layouts -->
    <div id="menu-content">

        <header>
            مدیر سیستم
        </header>

        <div id="profile">
            <img src="img/user.png" width="64" height="64" alt="User name" class="user-icon">

        </div>

        <!-- By default, this section is made for 4 icons, see the doc to learn how to change this, in "basic markup explained" -->
        <ul id="access" class="children-tooltip">
            <li><a href="inbox.html" title="رخدادهای سیستم"><span class="icon-inbox"></span><span class="count">2</span></a>
            </li>

            <li><a href="login.html" title="خروج"><span class="icon-user"></span></a></li>
            <li><span class="icon-gear"></span></li>
        </ul>
    </div>
</section>
<script src="js/libs/jquery-1.8.2.min.js"></script>
<script src="js/setup.js"></script>

<!-- Template functions -->
<script src="js/developr.input.js"></script>
<script src="js/developr.navigable.js"></script>
<script src="js/developr.message.js"></script>
<script src="js/developr.modal.js"></script>
<script src="js/developr.notify.js"></script>
<script src="js/developr.scroll.js"></script>
<script src="js/developr.progress-slider.js"></script>
<script src="js/developr.tooltip.js"></script>
<script src="js/developr.content-panel.js"></script>

<!-- Plugins -->
<script src="js/libs/jquery.tablesorter.min.js"></script>
<script src="js/libs/DataTables/jquery.dataTables.min.js"></script>

<script>
    // Call template init (optional, but faster if called manually)
    $.template.init();
    $(document).ready(function () {
        var table = $('#traffic_table');
        table.dataTable({
            "aaSorting": [],
            "bDestroy": true,
            "bJQueryUI": true,
            "bProcessing": true,
            "bDeferRender": true,
            "oLanguage": {
                "sProcessing": "درحال پردازش...",
                "sLengthMenu": "نمایش محتویات _MENU_",
                "sZeroRecords": "موردی یافت نشد",
                "sInfo": "نمایش _START_ تا _END_ از مجموع _TOTAL_ مورد",
                "sInfoEmpty": "تهی",
                "sInfoFiltered": "(فیلتر شده از مجموع _MAX_ مورد)",
                "sInfoPostFix": "",
                "sSearch": "جستجو:",
                "sUrl": "",
                "oPaginate": {
                    "sFirst": "ابتدا",
                    "sPrevious": "قبلی",
                    "sNext": "بعدی",
                    "sLast": "انتها"
                }
            },
            'sPaginationType': 'full_numbers',
            //'sDom': '<"dataTables_header"lfr>t<"dataTables_footer"ip>',
            'fnInitComplete': function (oSettings) {
                // Style length select
                // table.closest('.dataTables_wrapper').find('.dataTables_length select').addClass('select blue-gradient glossy').styleSelect();
                // tableStyled = true;
            },
            "aoColumns": [
                {
                    "sTitle": "تاریخ"
                },
                {
                    "sTitle": "زمان"
                },
                {
                    "sTitle": "پلاک"
                },
                {
                    "sTitle": "",
                    "fnRender": function (obj) {
                        var sReturn = obj.aData[obj.iDataColumn];
                        sReturn = '<center><div onclick="openComplexModal(' + "'" + sReturn + "'" + ');" class="button compact icon-pictures">مشاهده تصاویر</div></center>';
                        //  console.log(sReturn);
                        return sReturn;
                    }
                }
            ]
        });
        //reload(0 , 50);
        //loadData(50);
        //setInterval(function(){
        //    reload();
        //}, 5000);
    });

    var pageSize = 500;
    function queryByDate() {
        var fromDay = $("#from_date_day").val();
        var fromMonth = $("#from_date_month").val();
        var fromYear = $("#from_date_year").val();
        var toDay = $("#to_date_day").val();
        var toMonth = $("#to_date_month").val();
        var toYear = $("#to_date_year").val();

        var hasError = false;
        if (!fromDay || !fromMonth || !fromYear || !toYear || !toMonth || !toDay) {
            alert("لطفا زمان ها را مشخص نمایید");
            hasError = true;
        }
        else{
            var nimUrl = "/traffic/getTrafficPageByDate/" + fromDay +"/"+fromMonth +"/" + fromYear + "/" + toDay + "/" + toMonth + "/" + toYear +"/";
                    $.ajax({
                type: 'GET',
                url: nimUrl + "0/" + pageSize,
                dataType: 'json',
                success: function (result) {
                    reload(0, nimUrl);
                },
                error: function () {
                },
                async: true
            });
        }

    }

    function reload(page, nimUrl) {

        $.ajax({
            type: 'GET',
            url: nimUrl + page + "/" + pageSize,
            dataType: 'json',
            success: function (result) {
                var exist = false;
                var results = [];
                var table = $('#traffic_table').dataTable();
                for (var i = result.length - 1; i >= 0; i--) {
                    exist = true;
                    var d = "";
                    var correctedPlate = result[i].persianPlate2;
                    if (correctedPlate && correctedPlate.length == 8) {
                        d = (correctedPlate[0] + correctedPlate[1] + correctedPlate[2] + correctedPlate[3] + correctedPlate[4] + correctedPlate[5] + " ایران " + correctedPlate[6] + correctedPlate[7]);
                        d = '<div style="direction:rtl">' + d + '</div>';
                    }
                    var newObject = [
                        result[i].date,
                        result[i].time,
                        d,
                        result[i]._id
                    ];
                    table.fnAddData(newObject);
                    //results.push(newObject);
                }
                if (exist)
                    //if (page > 29) {
                        setTimeout(function () {
                            reload(page + 1, pageSize);
                        }, 500);
                   // }
            },
            error: function () {
            },
            async: true
        });
    }
    function showImages(id) {
        alert(id);
    }
    function openComplexModal(recordId) {
        $.ajax({
            type: 'GET',
            url: "/traffic/getListOfImages/" + recordId,
            dataType: 'json',
            success: function (result) {
                $.modal({
                    content: '<div  style="width:100%;"><img src="' + recordId + '/' + result[0] + '" width="100%"/> </div>',
                    title: 'تصویر',
                    width: 300,
                    scrolling: true,
                    actions: {
                        'بستن': {
                            color: 'red',
                            click: function (win) {
                                win.closeModal();
                            }
                        },
                        'مرکز': {
                            color: 'green',
                            click: function (win) {
                                win.centerModal(true);
                            }
                        },
                        'بزرگنمایی': {
                            color: 'red',
                            click: function () {
                                window.location = recordId + '/' + result[0];
                            }
                        }
                    },
                    contentBg: false,
                    buttons: {
                        'بازگشت': {
                            classes: 'huge blue-gradient glossy full-width kaveh',
                            click: function (win) {
                                win.closeModal();
                            }
                        }
                    },
                    buttonsLowPadding: true
                });
            },
            error: function () {
            },
            async: true
        });
    }
    ;
</script>
</body>
</html>
