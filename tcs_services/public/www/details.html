<!DOCTYPE html>

<!--[if IEMobile 7]>
<html class="no-js iem7 oldie"><![endif]-->
<!--[if (IE 7)&!(IEMobile)]>
<html class="no-js ie7 oldie" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]>
<html class="no-js ie8 oldie" lang="en"><![endif]-->
<!--[if (IE 9)&!(IEMobile)]>
<html class="no-js ie9" lang="en"><![endif]-->
<!--[if (gt IE 9)|(gt IEMobile 7)]><!-->
<html class="no-js" lang="en"><!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>سیستم کنترل تردد گروه صنعتی کاوه</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- http://davidbcalhoun.com/2010/viewport-metatag -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Additional styles -->
    <link rel="stylesheet" href="css/styles/form3860.css?v=1">
    <link rel="stylesheet" href="css/styles/modal3860.css?v=1">
    <link rel="stylesheet" href="css/styles/progress-slider3860.css?v=1">
    <link rel="stylesheet" href="css/styles/switches3860.css?v=1">
    <link rel="stylesheet" href="css/styles/table3860.css?v=1">
    <link rel="stylesheet" href="css/kss.css">

    <!-- For all browsers -->
    <link rel="stylesheet" href="css/reset3860.css?v=1">
    <link rel="stylesheet" href="css/style3860.css?v=1">
    <link rel="stylesheet" href="css/colors3860.css?v=1">
    <link rel="stylesheet" media="print" href="css/print3860.css?v=1">
    <!-- For progressively larger displays -->
    <link rel="stylesheet" media="only all and (min-width: 480px)" href="css/4803860.css?v=1">
    <link rel="stylesheet" media="only all and (min-width: 768px)" href="css/7683860.css?v=1">
    <link rel="stylesheet" media="only all and (min-width: 992px)" href="css/9923860.css?v=1">
    <link rel="stylesheet" media="only all and (min-width: 1200px)" href="css/12003860.css?v=1">
    <!-- For Retina displays -->
    <link rel="stylesheet"
          media="only all and (-webkit-min-device-pixel-ratio: 1.5), only screen and (-o-min-device-pixel-ratio: 3/2), only screen and (min-device-pixel-ratio: 1.5)"
          href="css/2x3860.css?v=1">

    <!-- DataTables -->
    <link rel="stylesheet" href="js/libs/DataTables/jquery.dataTables3860.css?v=1">

    <!-- Webfonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>

    <!-- Additional styles -->
    <link rel="stylesheet" href="css/styles/progress-slider3860.css?v=1">
    <link rel="stylesheet" href="css/styles/switches3860.css?v=1">
    <link rel="stylesheet" href="css/styles/files3860.css?v=1">

    <!-- JavaScript at bottom except for Modernizr -->
    <script src="js/libs/modernizr.custom.js"></script>

    <!-- For Modern Browsers -->
    <link rel="shortcut icon" href="img/favicons/favicon.png">
    <!-- For everything else -->
    <link rel="shortcut icon" href="img/favicons/favicon.ico">
    <!-- For retina screens -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/favicons/apple-touch-icon-retina.png">
    <!-- For iPad 1-->
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/favicons/apple-touch-icon-ipad.png">
    <!-- For iPhone 3G, iPod Touch and Android -->
    <link rel="apple-touch-icon-precomposed" href="img/favicons/apple-touch-icon.png">

    <!-- iOS web-app metas -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!-- Startup image for web apps -->
    <link rel="apple-touch-startup-image" href="img/splash/ipad-landscape.png"
          media="screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:landscape)">
    <link rel="apple-touch-startup-image" href="img/splash/ipad-portrait.png"
          media="screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:portrait)">
    <link rel="apple-touch-startup-image" href="img/splash/iphone.png" media="screen and (max-device-width: 320px)">

    <!-- Microsoft clear type rendering -->
    <meta http-equiv="cleartype" content="on">
</head>

<body class="clearfix with-menu with-shortcuts">

<!-- Prompt IE 6 users to install Chrome Frame -->
<!--[if lt IE 7]><p class="message red-gradient simpler">Your browser is <em>ancient!</em> <a
        href="http://browsehappy.com/">Upgrade to a different browser</a> or <a
        href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.
</p><![endif]-->

<!-- Title bar -->
<header role="banner" id="title-bar">
    <h2>
        سیستم کنترل تردد گروه صنعتی کاوه
    </h2>
</header>

<!-- Button to open/hide menu -->
<a href="javascript:void(0);" id="open-menu"><span>منو</span></a>

<!-- Button to open/hide shortcuts -->
<a href="javascript:void(0);" id="open-shortcuts"><span class="icon-thumbs"></span></a>

<section role="main" id="main">
<center>
    <noscript class="message black-gradient simpler">مرورگر شما از این نسخه از جاوا اسکریپت پیروی نمیکند. ممکن است بعضی
        از قابلیت ها کار نکند.
    </noscript>
    <div class="with-padding" style="margin-top:50px;">


    <div class="columns">

		<div class="box-layout four-columns twelve-columns-tablet" style="height:400px;">
		    
		    <p style="text-align:center;margin-top:10px;">
			    اطلاعات آخرین تردد
		    </p>
		    
		<hr/>

		    <table style="width:80%;direction:rtl;line-height:30px;">
			<tr>
			    <td>
				تاریخ تردد
			    </td>
			    <td id="lastTrafficDate">
			    </td>
			    
			</tr>
			    <tr>
			    <td>
				زمان تردد
			    </td>
			    <td id="lastTrafficTime">
			    </td>
			    
			</tr>
				<tr>
				<td>
					پلاک تشخیص داده شده
				</td>
				<td id="detectedPlate">
				</td>
			    </tr>
<tr>
				<td colaspan = "2">
				<hr/>	
				</td>
			    </tr>
			    <tr>
				<td>
				     <label for="input-3" class="label">نام</label>
				</td>
				<td>
				     <input type="text" name="firstName" id="firstName" size="9" class="input full-width" value="">
				</td>
			    </tr>

			    <tr>
				<td>
				     <label for="input-3" class="label">نام خانوادگی</label>
				</td>
				<td>
				     <input type="text" name="lastName" id="lastName" size="9" class="input full-width" value="">
				</td>
			    </tr>


			    <tr>
				<td>
				     <label for="input-3" class="label">کدملی</label>
				</td>
				<td>
				     <input type="text" name="nationalityCode" id="nationalityCode" size="9" class="input full-width" value="">
				</td>
			    </tr>
			    <tr><td colspan="2"><hr/></td></tr>

			    <tr>
				<td colspan="2" style="text-align:center;">
					<button class="button green-gradient" style="font-family: Tahoma; font-size: 12px; width: 50%;" onclick="saveDetails();">ثبت</button>
				</td>
			    </tr>
			    </tr>
<tr>
				<td colaspan = "2">
				<hr/>	
				</td>
			    </tr>
			    <tr>
				<td style="text-align:center;">
					<button class="button red-gradient" style="font-family: Tahoma; font-size: 10px; width: 80%;" onclick="nextImage();">تصویر بعدی</button>
				</td>
				<td style="text-align:center;">
					<button class="button blue-gradient" style="font-family: Tahoma; font-size: 10px; width: 80%;" onclick="saveDetails();">تمامی ترددها</button>
				</td>
			    </tr>

		    </table>
		</div>

		<div class="box-layout eight-columns twelve-columns-tablet" style="height:400px">
		<img id="lastTrafficImage" width="100%" height="100%" style="margin-bottm:10px;" />
		</div>

	    </div>
    </div>
</center>
</section>
<!-- End main content -->

<!-- Side tabs shortcuts -->
<ul id="shortcuts" role="complementary" class="children-tooltip tooltip-right">
    <li class="current"><a href="overview.html" class="shortcut-agenda" title="گزارش گیری">گزارش گیری</a></li>
    <li><a href="main.html" class="shortcut-messages" title="رخدادها">رخدادها</a></li>
    <li><a href="settings.html" class="shortcut-settings" title="تنظیمات">تنظیمات</a></li>
 <li><a href="dateReport.html" class="shortcut-contacts" title="براساس تاریخ">براساس تاریخ</a></li>
</ul>

<!-- Sidebar/drop-down menu -->
<section id="menu" role="complementary">

    <!-- This wrapper is used by several responsive layouts -->
    <div id="menu-content">

        <header>
            مدیر سیستم
        </header>

        <div id="profile">
            <img src="img/user.png" width="64" height="64" alt="User name" class="user-icon">

        </div>

        <!-- By default, this section is made for 4 icons, see the doc to learn how to change this, in "basic markup explained" -->
        <ul id="access" class="children-tooltip">
            <li><a href="inbox.html" title="رخدادهای سیستم"><span class="icon-inbox"></span><span class="count">2</span></a>
            </li>

            <li><a href="login.html" title="خروج"><span class="icon-user"></span></a></li>
            <li><span class="icon-gear"></span></li>
        </ul>

        <!--<section class="navigable" >-->
        <!--<ul class="big-menu">-->
        <!--<li class="with-right-arrow">-->
        <!--<span><span class="list-count">3</span>گزارش گیری</span>-->
        <!--<ul class="big-menu">-->
        <!--<li><a href="typography.html">امتیاز من</a></li>-->
        <!--<li><a href="columns.html">سابقه پرداخت</a></li>-->
        <!--<li><a href="tables.html">پرداخت جدید</a></li>-->
        <!--</ul>-->
        <!--</li>-->
        <!--<li class="with-right-arrow">-->
        <!--<span><span class="list-count">2</span>حساب کاربری</span>-->
        <!--<ul class="big-menu">-->
        <!--<li><a href="colors.html">پروفایل</a></li>-->
        <!--<li><a href="colors.html">کلمه عبور</a></li>-->
        <!--</ul>-->
        <!--</li>-->
        <!---->
        <!---->
        <!--</ul>-->
        <!--</section>-->
    </div>
    <!-- End content wrapper -->

    <!-- This is optional -->
    <!--<footer id="menu-footer">-->
    <!--<p class="button-height">-->
    <!--<input type="checkbox" name="auto-refresh" id="auto-refresh" checked="checked" class="switch float-right">-->
    <!--<label for="auto-refresh">Auto-refresh</label>-->
    <!--</p>-->
    <!--</footer>-->

</section>
<!-- End sidebar/drop-down menu -->

<!-- JavaScript at the bottom for fast page loading -->

<!-- Scripts -->
<script src="js/libs/jquery-1.8.2.min.js"></script>
<script src="js/setup.js"></script>

<!-- Template functions -->
<script src="js/developr.input.js"></script>
<script src="js/developr.navigable.js"></script>
<script src="js/developr.message.js"></script>
<script src="js/developr.modal.js"></script>
<script src="js/developr.notify.js"></script>
<script src="js/developr.scroll.js"></script>
<script src="js/developr.progress-slider.js"></script>
<script src="js/developr.tooltip.js"></script>
<script src="js/developr.content-panel.js"></script>

<!-- Plugins -->
<script src="js/libs/jquery.tablesorter.min.js"></script>
<script src="js/libs/DataTables/jquery.dataTables.min.js"></script>

<script>

    // Call template init (optional, but faster if called manually)
    $.template.init();

    $(document).ready(function () {
	var qs = getQueryStrings();
        var trafficId = qs["trafficId"];
	console.log(trafficId);
	LoadById(trafficId);
    });
    
    var images;
	    var index= 0;
var plate;
    var recordI = recordId;
    function loadImage(recordId){
	recordI = recordId;
     $.ajax({
            type: 'GET',
            url: "/traffic/getListOfImages/" + recordId,
            dataType: 'json',
            success: function (result) {
		    images = result;
		    $("#lastTrafficImage").prop("src", recordId + '/' + result[0]);
		    //var img = '<img src="' + recordId + '/' + result[0]  + '" width="100%"/>'; 
            },
            error: function () {
            },
            async: true});    
}

    function LoadById(id){
	 $.ajax({
            type: 'GET',
            url: "/traffic/getTrafficById/" + id,
            dataType: 'json',
            success: function (result) {
                var results = [];
var d = "";
	    var correctedPlate = result.persianPlate2;
	    plate = correctedPlate;
	    getProfile();
	    if(correctedPlate && correctedPlate.length == 8)
	    {
		d = (correctedPlate[0]  + correctedPlate[1] +  correctedPlate[2]  +  correctedPlate[3] + correctedPlate[4] + correctedPlate[5] + " ایران " +correctedPlate[6] +  correctedPlate[7]);
		d= '<div style="direction:rtl">' + d + '</div>';
	    }
		$("#lastTrafficDate").html(result.date);
		$("#lastTrafficTime").html(result.time);
		$("#detectedPlate").html(d);
		loadImage(result._id);
		walk(document.body, replaceNumbers);
            },
            error: function () {
            },
            async: false});
    }

function getQueryStrings() {
    var assoc = {};
    var decode = function (s) {
        return decodeURIComponent(s.replace(/\+/g, " "));
    };
    var queryString = location.search.substring(1);
    var keyValues = queryString.split('&');

    for (var i in keyValues) {
        var key = keyValues[i].split('=');
        if (key.length > 1) {
            assoc[decode(key[0])] = decode(key[1]);
        }
    }

    return assoc;
}

function walk(node, func) {
    func(node);
    node = node.firstChild;
    while (node) {
        walk(node, func);
        node = node.nextSibling;
    }
};

function replaceNumbers(node) {
    if (node.nodeType == 3) //Text nodes only
        node.nodeValue = node.nodeValue.replace(/[0-9]/g, getArabicNumber);
}

function getArabicNumber(n) {
    return String.fromCharCode(1632 + parseInt(n, 10));
}

function nextImage(){
    		    index++;
		    if(index >= images.length)
			index = 0;
		    
		    $("#lastTrafficImage").prop("src", recordI + '/' + images[index]);

}

function saveDetails(){
    var firstName = $("#firstName").val();
    var lastName = $("#lastName").val();
    var nationalityCode = $("#nationalityCode").val();
    console.log(firstName + " : " + lastName + " : " + nationalityCode);
	 $.ajax({
            type: 'GET',
            url: "/traffic/saveProfile/" + firstName +"/" + lastName + "/" + nationalityCode + "/" + plate,
            dataType: 'json',
            success: function (result) {
		//alert('saved');
            },
            error: function () {
            },
            async: false});
    
}

function getProfile(){
    $.ajax({
            type: 'GET',
            url: "/traffic/getProfile/" + plate,
            dataType: 'json',
            success: function (result) {
		    $("#firstName").val(result.firstName);
		    $("#lastName").val(result.lastName);
		    $("#nationalityCode").val(result.nationalityCode);
            },
            error: function () {
            },
            async: false});
}

</script>
</body>
</html>
